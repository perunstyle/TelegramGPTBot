# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Google OAuth –¥–ª—è ChatGPT+

## üéØ –ß—Ç–æ —ç—Ç–æ –¥–∞–µ—Ç

–í–º–µ—Å—Ç–æ —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ, –±–æ—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é —á–µ—Ä–µ–∑ Google OAuth –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ ChatGPT+.

## üìã –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

1. **Google –∞–∫–∫–∞—É–Ω—Ç** —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ ChatGPT+
2. **Google Cloud Console** –ø—Ä–æ–µ–∫—Ç
3. **OAuth 2.0** –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

## üîß –ü–æ—à–∞–≥–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞ –≤ Google Cloud Console

1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ [Google Cloud Console](https://console.cloud.google.com/)
2. –°–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—ã–π –ø—Ä–æ–µ–∫—Ç –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π
3. –í–∫–ª—é—á–∏—Ç–µ **Google+ API** –∏ **OAuth 2.0**

### –®–∞–≥ 2: –°–æ–∑–¥–∞–Ω–∏–µ OAuth 2.0 –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

1. –í –º–µ–Ω—é —Å–ª–µ–≤–∞ –≤—ã–±–µ—Ä–∏—Ç–µ **"APIs & Services"** ‚Üí **"Credentials"**
2. –ù–∞–∂–º–∏—Ç–µ **"Create Credentials"** ‚Üí **"OAuth 2.0 Client IDs"**
3. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: **"Desktop application"**
4. –í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ: `TelegramGPTBot`
5. –ù–∞–∂–º–∏—Ç–µ **"Create"**

### –®–∞–≥ 3: –ü–æ–ª—É—á–µ–Ω–∏–µ Client ID –∏ Client Secret

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ:
- **Client ID** - —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ
- **Client Secret** - —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –µ–≥–æ

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ redirect URI

–í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö OAuth –∫–ª–∏–µ–Ω—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ:
```
http://localhost:8080/callback
```

### –®–∞–≥ 5: –ü–æ–ª—É—á–µ–Ω–∏–µ Authorization Code

1. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π–¥–∏—Ç–µ –ø–æ URL:
```
https://accounts.google.com/o/oauth2/v2/auth?
client_id=–í–ê–®_CLIENT_ID&
redirect_uri=http://localhost:8080/callback&
scope=https://www.googleapis.com/auth/userinfo.email https://www.googleapis.com/auth/userinfo.profile openid&
response_type=code&
access_type=offline&
prompt=consent
```

2. –í–æ–π–¥–∏—Ç–µ –≤ Google –∞–∫–∫–∞—É–Ω—Ç
3. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é
4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ **authorization code** –∏–∑ URL (–ø–∞—Ä–∞–º–µ—Ç—Ä `code=`)

### –®–∞–≥ 6: –û–±–º–µ–Ω –∫–æ–¥–∞ –Ω–∞ —Ç–æ–∫–µ–Ω—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —É—Ç–∏–ª–∏—Ç—É `GoogleOAuthHelper` –∏–ª–∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ POST –∑–∞–ø—Ä–æ—Å:

```bash
curl -X POST https://oauth2.googleapis.com/token \
  -d "client_id=–í–ê–®_CLIENT_ID" \
  -d "client_secret=–í–ê–®_CLIENT_SECRET" \
  -d "code=–ê–í–¢–û–†–ò–ó–ê–¶–ò–û–ù–ù–´–ô_–ö–û–î" \
  -d "grant_type=authorization_code" \
  -d "redirect_uri=http://localhost:8080/callback"
```

### –®–∞–≥ 7: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–û–±–Ω–æ–≤–∏—Ç–µ `appsettings.json`:

```json
"GoogleOAuth": {
  "ClientId": "–í–ê–®_CLIENT_ID",
  "ClientSecret": "–í–ê–®_CLIENT_SECRET", 
  "RefreshToken": "–í–ê–®_REFRESH_TOKEN",
  "RedirectUri": "http://localhost:8080/callback"
}
```

## üîê –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

‚úÖ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ OAuth:**
- –ù–µ—Ç –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤
- –û—Ç–∑—ã–≤ –¥–æ—Å—Ç—É–ø–∞ –≤ –ª—é–±–æ–π –º–æ–º–µ–Ω—Ç
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

‚ö†Ô∏è **–í–∞–∂–Ω–æ:**
- –•—Ä–∞–Ω–∏—Ç–µ `ClientSecret` –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- `RefreshToken` –¥–∞–µ—Ç –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–π –¥–æ—Å—Ç—É–ø
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å –Ω–∞ Google OAuth:

```
/switch GoogleOAuth
```

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –±–æ—Ç–∞: `dotnet run`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã: `/providers`
3. –ü–µ—Ä–µ–∫–ª—é—á–∏—Ç–µ—Å—å: `/switch GoogleOAuth`
4. –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ

## üÜò –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –û—à–∏–±–∫–∞ "invalid_client"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å Client ID –∏ Client Secret
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω–æ

### –û—à–∏–±–∫–∞ "invalid_grant" 
- Refresh token –∏—Å—Ç–µ–∫ –∏–ª–∏ –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω
- –ü–æ–ª—É—á–∏—Ç–µ –Ω–æ–≤—ã–π authorization code

### –û—à–∏–±–∫–∞ "access_denied"
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ OAuth –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ API –≤–∫–ª—é—á–µ–Ω—ã

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [Google OAuth 2.0 –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](https://developers.google.com/identity/protocols/oauth2)
- [Google Cloud Console](https://console.cloud.google.com/)
- [OAuth 2.0 Playground](https://developers.google.com/oauthplayground/)
